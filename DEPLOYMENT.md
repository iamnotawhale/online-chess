# üöÄ –î–µ–ø–ª–æ–π Chess Online –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ubuntu/Debian —Å–µ—Ä–≤–µ—Ä —Å root –¥–æ—Å—Ç—É–ø–æ–º
- Docker –∏ Docker Compose
- –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è, —É–∫–∞–∑—ã–≤–∞—é—â–µ–µ –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker Compose
sudo apt install docker-compose-plugin -y

# –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è
exit
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
cd /opt
sudo git clone https://github.com/iamnotawhale/online-chess.git
sudo chown -R $USER:$USER online-chess
cd online-chess
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
echo "DB_PASSWORD=$(openssl rand -base64 32)" >> .env
echo "JWT_SECRET=$(openssl rand -base64 64)" >> .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env –∏ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π –¥–æ–º–µ–Ω
nano .env
```

–ü—Ä–∏–º–µ—Ä `.env`:
```
DB_PASSWORD=generated_password_here
JWT_SECRET=generated_jwt_secret_here
FRONTEND_URL=https://chess.yourdomain.com
BACKEND_URL=https://chess.yourdomain.com/api
DOMAIN=chess.yourdomain.com
```

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS

–î–æ–±–∞–≤—å—Ç–µ A-–∑–∞–ø–∏—Å—å –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞, —É–∫–∞–∑—ã–≤–∞—é—â—É—é –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞:
```
A    chess.yourdomain.com    ‚Üí    YOUR_SERVER_IP
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–±–µ–∑ SSL)

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x deploy.sh setup-ssl.sh

# –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å SSL –≤ nginx.conf (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å ssl —Å–µ–∫—Ü–∏—é)
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –≤–µ—Ä—Å–∏—é –±–µ–∑ SSL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
./deploy.sh
```

### 6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

```bash
# –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ email)
./setup-ssl.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx
docker-compose -f docker-compose.prod.yml restart nginx
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose -f docker-compose.prod.yml logs -f

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker-compose -f docker-compose.prod.yml logs -f backend
docker-compose -f docker-compose.prod.yml logs -f frontend
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
docker-compose -f docker-compose.prod.yml restart
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
docker-compose -f docker-compose.prod.yml down
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
git pull
./deploy.sh
```

### –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
docker exec chess_postgres_prod pg_dump -U chess chessonline > backup_$(date +%Y%m%d_%H%M%S).sql
```

## Troubleshooting

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker-compose -f docker-compose.prod.yml ps
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
```bash
sudo netstat -tlnp | grep -E ':(80|443|8082|5432)'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ nginx
```bash
docker exec chess_nginx cat /var/log/nginx/error.log
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL
–ï—Å–ª–∏ SSL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. DNS –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (ping chess.yourdomain.com)
2. –ü–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ
3. Certbot —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∏–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo docker run --rm -v $(pwd)/certbot/conf:/etc/letsencrypt certbot/certbot certificates

# –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo docker run --rm -v $(pwd)/certbot/conf:/etc/letsencrypt -v $(pwd)/certbot/www:/var/www/certbot certbot/certbot renew
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **Firewall**: –û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç—ã 22 (SSH), 80 (HTTP), 443 (HTTPS)
```bash
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º—É
```bash
sudo apt update && sudo apt upgrade -y
```

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å monitoring stack (Prometheus + Grafana)
# –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Ç–∏–ø–∞ Uptimerobot
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –°–µ—Ä–≤–µ—Ä —Å –º–∏–Ω–∏–º—É–º **2 GB RAM** –∏ **2 CPU cores**
- –î–ª—è –±–æ–ª—å—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **4 GB RAM**
- SSD –¥–∏—Å–∫ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Issues –Ω–∞ GitHub –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π.
