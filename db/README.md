# Database Migrations

Автоматическая система миграций для ChessOnline.

## Как это работает

1. Все миграции хранятся в `db/migrations/`
2. Файлы называются по шаблону: `001_description.sql`, `002_description.sql`
3. При деплое скрипт `db/apply-migrations.sh` автоматически:
   - Создаёт таблицу `schema_migrations` (если её нет)
   - Проверяет какие миграции уже применены
   - Применяет новые миграции по порядку
   - Записывает в `schema_migrations` список примененных файлов

## Создание новой миграции

1. Создайте файл `db/migrations/00X_description.sql`
2. Напишите SQL-код миграции
3. Коммитьте и пушьте - миграция применится автоматически при деплое

## Ручное применение миграций

Локально:
```bash
./db/apply-migrations.sh
```

На сервере (через SSH):
```bash
cd /путь/к/проекту
./db/apply-migrations.sh
```

## Проверка статуса миграций

```bash
docker exec chess_postgres psql -U chess -d chessonline -c "SELECT * FROM schema_migrations ORDER BY applied_at;"
```

## Примеры миграций

- `001_cleanup_unused_fields.sql` - удаление неиспользуемых полей
- `002_change_id_to_varchar.sql` - изменение ID с UUID на VARCHAR(10)

## Важно

- Миграции применяются в алфавитном порядке
- Нумеруйте файлы с ведущими нулями: `001`, `002`, `010`, `100`
- Миграции должны быть идемпотентными (если возможно)
- После применения миграции нельзя изменять - создайте новую
